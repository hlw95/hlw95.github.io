<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Category: 大数据 - Lavine Hu</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Lavine Hu"><meta name="msapplication-TileImage" content="https://cdn.jsdelivr.net/gh/removeif/removeif-demo@latest/img/favicon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Lavine Hu"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Lavine Hu"><meta property="og:url" content="https://github.com/hlw95?tab=following"><meta property="og:site_name" content="Lavine Hu"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/removeif/removeif-demo@latest/img/avatar.png"><meta property="article:author" content="Lavine Hu"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://cdn.jsdelivr.net/gh/removeif/removeif-demo@latest/img/avatar.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"Lavine Hu","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"Lavine Hu"},"description":""}</script><link rel="icon" href="https://cdn.jsdelivr.net/gh/removeif/removeif-demo@latest/img/favicon.png"><meta name="referrer" content="no-referrer-when-downgrade"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="/js/globalUtils.js"></script><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/pace/1.0.2/pace.min.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Lavine Hu</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/message">留言</a></div><div class="navbar-end"><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="/js/theme-setting.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/categories">Categories</a></li><li class="is-active"><a href="#" aria-current="page">大数据</a></li></ul></nav></div></div><!--!--><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-01-26  <a class="commentCountImg" href="/2022/01/26/hadoop-persudo/#comment-container"><span class="display-none-class">b3c525fed5cec51f51d53567da1a6983</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="b3c525fed5cec51f51d53567da1a6983">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>2 m  <i class="fas fa-pencil-alt"> </i>0.3 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/01/26/hadoop-persudo/">Hadoop部署方式</a></h1><div class="content"><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/aohun0743/article/details/101702331">https://blog.csdn.net/aohun0743/article/details/101702331</a></p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1924241?from=article.detail.1336692">https://cloud.tencent.com/developer/article/1924241?from=article.detail.1336692</a></p>
<p><strong>本地模式</strong></p>
<p>单机运行，只是用来演示一下官方案例。生产环境不用。</p>
<p><strong>伪分布式模式</strong></p>
<p>也是单机运行，但是具备Hadoop集群的所有功能，一台服务器模拟一个分布式的环境。个别缺钱的公司用来测试，生产环境不用。</p>
<p><strong>完全分布式模式</strong></p>
<p>多台服务器组成分布式环境。生产环境使用。</p>
<p>搭建：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/a1786742005/article/details/104104983">https://blog.csdn.net/a1786742005/article/details/104104983</a></p>
<p><strong>高可用完全分布式模式</strong></p>
<p>HA高可用是Hadoop2.x才开始引入的机制，是为了解决Hadoop的单点故障问题。主要有两种部署方式，一种是NFS（Network File System）方式，另外一种是QJM（Quorum Journal Manager）方式。用得较多的是QJM方式，稳定性更好。实际操作中，生产环境的Hadoop集群搭建一般都会做HA部署。</p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6/">基础组件</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6/hadoop/">hadoop</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/Hadoop%E9%83%A8%E7%BD%B2%E6%96%B9%E5%BC%8F/">Hadoop部署方式</a></div><hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-01-25  <a class="commentCountImg" href="/2022/01/25/spark-rdd/#comment-container"><span class="display-none-class">246c4cd5e9120863ab7086a903ed561b</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="246c4cd5e9120863ab7086a903ed561b">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>2 m  <i class="fas fa-pencil-alt"> </i>0.4 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/01/25/spark-rdd/">RDD，DataFrame，Dataset</a></h1><div class="content"><p><a target="_blank" rel="noopener" href="https://blog.knoldus.com/spark-rdd-vs-dataframes/">https://blog.knoldus.com/spark-rdd-vs-dataframes/</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/hellozhxy/article/details/82660610">https://blog.csdn.net/hellozhxy/article/details/82660610</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/lestatzhang/p/10611320.html#Spark_16">https://www.cnblogs.com/lestatzhang/p/10611320.html#Spark_16</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/77811ae29fdd">https://www.jianshu.com/p/77811ae29fdd</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/379578271">https://zhuanlan.zhihu.com/p/379578271</a></p>
<p><a target="_blank" rel="noopener" href="https://spark.apache.org/docs/3.2.0/sql-programming-guide.html#content">https://spark.apache.org/docs/3.2.0/sql-programming-guide.html#content</a></p>
<p><img src="/2022/01/25/spark-rdd/1.png" alt></p>
<h2 id="1-DataFrame-和-RDDs-应该如何选择？"><a href="#1-DataFrame-和-RDDs-应该如何选择？" class="headerlink" title="1 DataFrame 和 RDDs 应该如何选择？"></a>1 DataFrame 和 RDDs 应该如何选择？</h2><p>DataFrame 和 RDDs 最主要的区别在于一个面向的是结构化数据，一个面向的是非结构化数据</p>
<ul>
<li>如果你的数据是结构化的 (如 RDBMS 中的数据) 或者半结构化的 (如日志)，出于性能上的考虑，应优先使用 DataFrame。</li>
<li>如果你的数据是非结构化的 (比如流媒体或者字符流)，则使用 RDDs，</li>
</ul>
<h2 id="2-为什么出现Dataset？"><a href="#2-为什么出现Dataset？" class="headerlink" title="2 为什么出现Dataset？"></a>2 为什么出现Dataset？</h2><p>1.相比DataFrame，Dataset提供了编译时类型检查，对于分布式程序来讲，提交一次作业太费劲了（要编译、打包、上传、运行），到提交到集群运行时才发现错误，实在是想骂人，这也是引入Dataset的一个重要原因。</p>
<p>2.RDD转换DataFrame后不可逆，但RDD转换Dataset是可逆的（这也是Dataset产生的原因）</p>
<p>注意：</p>
<p>The Dataset API is available in <a target="_blank" rel="noopener" href="https://spark.apache.org/docs/3.2.0/api/scala/org/apache/spark/sql/Dataset.html">Scala</a> and <a target="_blank" rel="noopener" href="https://spark.apache.org/docs/3.2.0/api/java/index.html?org/apache/spark/sql/Dataset.html">Java</a>. Python does not have the support for the Dataset API. But due to Python’s dynamic nature, many of the benefits of the Dataset API are already available (i.e. you can access the field of a row by name naturally <code>row.columnName</code>).</p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6/">基础组件</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6/spark/">spark</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6/spark/%E4%BD%BF%E7%94%A8/">使用</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/RDD%E3%80%81DataFrame%E3%80%81DataSet/">RDD、DataFrame、DataSet</a></div><hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-01-25  <a class="commentCountImg" href="/2022/01/25/dimention-modeling/#comment-container"><span class="display-none-class">73241b5f95136af39e6cd1b31353cbc7</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="73241b5f95136af39e6cd1b31353cbc7">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>5 m  <i class="fas fa-pencil-alt"> </i>0.7 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/01/25/dimention-modeling/">数仓建模</a></h1><div class="content"><p>关系建模和维度建模是两种数据仓库的建模技术。关系建模由Bill Inmon所倡导，维度建模由Ralph Kimball所倡导。目前主流为维度建模。</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/362991213">https://zhuanlan.zhihu.com/p/362991213</a></p>
<h2 id="1-关系建模（范式建模）"><a href="#1-关系建模（范式建模）" class="headerlink" title="1.关系建模（范式建模）"></a>1.关系建模（范式建模）</h2><h3 id="1-1-范式"><a href="#1-1-范式" class="headerlink" title="1.1 范式"></a>1.1 范式</h3><p>1 目的</p>
<p>降低数据的冗余性</p>
<p>2 目前业界范式</p>
<p>第一范式(1NF)、第二范式(2NF)、第三范式(3NF)、巴斯-科德范式(BCNF)、第四范式(4NF)、第五范式(5NF)。逐个遵循，一般要求遵循第一，第二，第三范式，也就是三范式。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Dream_angel_Z/article/details/45175621">https://blog.csdn.net/Dream_angel_Z/article/details/45175621</a></p>
<h3 id="1-2-建模"><a href="#1-2-建模" class="headerlink" title="1.2 建模"></a>1.2 建模</h3><p><img src="/2022/01/25/dimention-modeling/7.JPG" alt></p>
<p>1 建模</p>
<p>关系建模将复杂的数据抽象为两个概念——<strong>实体和关系（实体表，关系表），并使用规范化（三范式）的方式表示</strong>出来</p>
<p>2 特点</p>
<p>关系模型严格遵循第三范式（3NF），数据冗余程度低，数据的一致性容易得到保证。</p>
<p>由于数据分布于众多的表中，查询会相对复杂，在大数据的场景下，查询效率相对较低。</p>
<h2 id="2-维度建模"><a href="#2-维度建模" class="headerlink" title="2.维度建模"></a>2.维度建模</h2><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/daab50a23c56">https://www.jianshu.com/p/daab50a23c56</a></p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1772027">https://cloud.tencent.com/developer/article/1772027</a></p>
<h3 id="2-1-事实表和维度表"><a href="#2-1-事实表和维度表" class="headerlink" title="2.1 事实表和维度表"></a>2.1 事实表和维度表</h3><p>1 事实表</p>
<p>存储业务事实，事实表中的每行数据代表一个业务事件（下单、支付、退款、评价等）。</p>
<p>事实表的特征：</p>
<p>​    内容相对的窄：列数较少（主要是外键id和度量值）</p>
<p>​    非常的大</p>
<p>​    经常发生变化，每天会新增加很多。</p>
<p>分类：事务型事实表，周期型快照事实表，累积型快照事实表</p>
<p><img src="/2022/01/25/dimention-modeling/1.png" alt></p>
<p>2 维度表</p>
<p>维度表：一般是对事实的描述信息。每一张维表对应现实世界中的一个对象或者概念。  例如：用户、商品、日期、地区等。</p>
<p>维表的特征：</p>
<p>​    维表的范围很宽（具有多个属性、列比较多）</p>
<p>​    跟事实表相比，行数相对较小：通常&lt; 10万条</p>
<p>​    内容相对固定：编码表</p>
<h3 id="2-2-维度模型分类"><a href="#2-2-维度模型分类" class="headerlink" title="2.2 维度模型分类"></a>2.2 维度模型分类</h3><p>在维度建模的基础上又分为三种模型：星型模型、雪花模型、星座模型。</p>
<p><img src="/2022/01/25/dimention-modeling/4.JPG" alt></p>
<p><img src="/2022/01/25/dimention-modeling/5.JPG" alt></p>
<p>星座模型是多个星型模型交织</p>
<h3 id="2-3-建模"><a href="#2-3-建模" class="headerlink" title="2.3 建模"></a>2.3 建模</h3><p><img src="/2022/01/25/dimention-modeling/6.JPG" alt></p>
<p>1 建模</p>
<p>维度模型面向业务，将业务用<strong>事实表和维度表</strong>呈现出来。</p>
<p>步骤：</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/suheng01/p/13522677.html">https://www.cnblogs.com/suheng01/p/13522677.html</a></p>
<p>选择业务过程→声明粒度→确认维度→确认事实</p>
<p>2 特点</p>
<p>维度模型以数据分析作为出发点，不遵循三范式，故数据存在一定的冗余。</p>
<p>表结构简单，故查询简单，查询效率较高。</p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/">数据仓库</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E6%95%B0%E4%BB%93/">数仓</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E6%95%B0%E4%BB%93/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93/">离线数仓</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/%E6%95%B0%E4%BB%93%E5%BB%BA%E6%A8%A1/">数仓建模</a></div><hr></div></article></div><!--!--><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-01-20  <a class="commentCountImg" href="/2022/01/20/spark-data-im/#comment-container"><span class="display-none-class">1f88d0eb62ee147bee8ff37b97f5bdab</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="1f88d0eb62ee147bee8ff37b97f5bdab">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>fast  <i class="fas fa-pencil-alt"> </i>0.1 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/01/20/spark-data-im/">Spark 数据倾斜</a></h1><div class="content"><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/kaede1209/article/details/81145560">https://blog.csdn.net/kaede1209/article/details/81145560</a></p>
<p><a target="_blank" rel="noopener" href="https://tech.meituan.com/2016/05/12/spark-tuning-pro.html">https://tech.meituan.com/2016/05/12/spark-tuning-pro.html</a></p>
<p>发生在两个过程：</p>
<ol>
<li>数据源数据不均匀</li>
<li>shuffle过程中key的分布不均<ol>
<li>单个rdd中进行聚合的时候key分布不均</li>
<li>多个rdd进行join过程中key的不均匀</li>
</ol>
</li>
</ol>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6/">基础组件</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6/spark/">spark</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6/spark/%E4%BC%98%E5%8C%96/">优化</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/Spark-%E6%95%B0%E6%8D%AE%E5%80%BE%E6%96%9C/">Spark 数据倾斜</a></div><hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-01-20  <a class="commentCountImg" href="/2022/01/20/datawarehouse-struct/#comment-container"><span class="display-none-class">a41c1b8f3fea617b9d17d429a14ceb43</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="a41c1b8f3fea617b9d17d429a14ceb43">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>fast  <i class="fas fa-pencil-alt"> </i>0.0 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/01/20/datawarehouse-struct/">数仓架构</a></h1><div class="content"><p>数仓架构</p>
<p><a target="_blank" rel="noopener" href="https://notomato.blog.csdn.net/article/details/110790403">https://notomato.blog.csdn.net/article/details/110790403</a></p>
<p>离线数据仓库到实时数据仓库</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/fuyipingwml1976124/article/details/105571193">https://blog.csdn.net/fuyipingwml1976124/article/details/105571193</a></p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/">数据仓库</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E6%95%B0%E4%BB%93/">数仓</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E6%95%B0%E4%BB%93/%E5%AE%9E%E6%97%B6%E6%95%B0%E4%BB%93/">实时数仓</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/%E6%95%B0%E4%BB%93%E6%9E%B6%E6%9E%84/">数仓架构</a></div><hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-01-19  <a class="commentCountImg" href="/2022/01/19/spark-wide-narrow-dependancy/#comment-container"><span class="display-none-class">73bd08cfafb536ce948fe047bd7c14b5</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="73bd08cfafb536ce948fe047bd7c14b5">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>a minute  <i class="fas fa-pencil-alt"> </i>0.2 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/01/19/spark-wide-narrow-dependancy/">RDD依赖关系</a></h1><div class="content"><h2 id="为什么要提出宽窄依赖"><a href="#为什么要提出宽窄依赖" class="headerlink" title="为什么要提出宽窄依赖"></a>为什么要提出宽窄依赖</h2><p>根据rdd的依赖关系构建dag，根据dag划分stage</p>
<h2 id="如何区别宽窄依赖"><a href="#如何区别宽窄依赖" class="headerlink" title="如何区别宽窄依赖"></a>如何区别宽窄依赖</h2><p><img src="/2022/01/19/spark-wide-narrow-dependancy/1.jpg" alt></p>
<p>父rdd  -&gt; 子rdd， 蓝色框是rdd分区</p>
<p>union：2个父rdd  -&gt;  1个子rdd</p>
<p>区分宽窄依赖主要就是看父RDD数据流向，要是流向一个的话就是窄依赖，流向多个的话就是宽依赖。</p>
<h2 id="划分stage"><a href="#划分stage" class="headerlink" title="划分stage"></a>划分stage</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_40271036/article/details/79996516">https://blog.csdn.net/weixin_40271036/article/details/79996516</a></p>
<p><img src="/2022/01/19/spark-wide-narrow-dependancy/2.jpg" alt></p>
<p>整体思路是：从后往前推，遇到宽依赖就断开，划分为一个stage；遇到窄依赖就将这个RDD加入该stage中</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/5c2301dfa360">https://www.jianshu.com/p/5c2301dfa360</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/67068559">https://zhuanlan.zhihu.com/p/67068559</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_49834705/article/details/113111596">https://blog.csdn.net/m0_49834705/article/details/113111596</a></p>
<p><a target="_blank" rel="noopener" href="https://lmrzero.blog.csdn.net/article/details/106015264?spm=1001.2014.3001.5502">https://lmrzero.blog.csdn.net/article/details/106015264?spm=1001.2014.3001.5502</a></p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6/">基础组件</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6/spark/">spark</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6/spark/%E5%8E%9F%E7%90%86/">原理</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/RDD%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB/">RDD依赖关系</a></div><hr></div></article></div><!--!--><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-01-19  <a class="commentCountImg" href="/2022/01/19/spark-shuffle/#comment-container"><span class="display-none-class">1b024bdbc8c2eff4b0816058de242495</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="1b024bdbc8c2eff4b0816058de242495">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>4 m  <i class="fas fa-pencil-alt"> </i>0.6 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/01/19/spark-shuffle/">shuffle</a></h1><div class="content"><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/arachis/p/Spark_Shuffle.html">https://www.cnblogs.com/arachis/p/Spark_Shuffle.html</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/70331869">https://zhuanlan.zhihu.com/p/70331869</a></p>
<p><a target="_blank" rel="noopener" href="https://www.educba.com/spark-shuffle/">https://www.educba.com/spark-shuffle/</a></p>
<p><a target="_blank" rel="noopener" href="https://lmrzero.blog.csdn.net/article/details/106015264?spm=1001.2014.3001.5502">https://lmrzero.blog.csdn.net/article/details/106015264?spm=1001.2014.3001.5502</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zp17834994071/article/details/107887292">https://blog.csdn.net/zp17834994071/article/details/107887292</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/431015932">https://zhuanlan.zhihu.com/p/431015932</a></p>
<h2 id="0-shuffle是什么，什么时候shuffle"><a href="#0-shuffle是什么，什么时候shuffle" class="headerlink" title="0 shuffle是什么，什么时候shuffle"></a>0 shuffle是什么，什么时候shuffle</h2><p><img src="/2022/01/19/spark-shuffle/1.png" alt></p>
<p>what：多个partition的数据流向一个partition</p>
<p>when：宽依赖会有shuffle</p>
<p>shuffle分为两个阶段：shuffle read  ， shuffle write</p>
<p>map端-》shuffle read-》 shuffle write-》reduce端</p>
<h2 id="1-mapreduce-shuffle"><a href="#1-mapreduce-shuffle" class="headerlink" title="1 mapreduce shuffle"></a>1 mapreduce shuffle</h2><p><img src="/2022/01/19/spark-shuffle/1.JPG" alt></p>
<h2 id="2-spark-shuffle"><a href="#2-spark-shuffle" class="headerlink" title="2 spark shuffle"></a>2 spark shuffle</h2><h3 id="1-简介"><a href="#1-简介" class="headerlink" title="1 简介"></a>1 简介</h3><p><img src="/2022/01/19/spark-shuffle/2.JPG" alt></p>
<p><img src="/2022/01/19/spark-shuffle/3.JPG" alt=" "></p>
<h3 id="2-分类"><a href="#2-分类" class="headerlink" title="2 分类"></a>2 分类</h3><p><a target="_blank" rel="noopener" href="https://www.51cto.com/article/703950.html#">https://www.51cto.com/article/703950.html#</a></p>
<p>过去hash shuffle ，现在sort shuffle</p>
<h4 id="1-Hash-Shuffle"><a href="#1-Hash-Shuffle" class="headerlink" title="1.Hash Shuffle"></a>1.Hash Shuffle</h4><p><img src="/2022/01/19/spark-shuffle/4.JPG" alt></p>
<p><img src="/2022/01/19/spark-shuffle/5.JPG" alt></p>
<p><img src="/2022/01/19/spark-shuffle/6.JPG" alt></p>
<h4 id="2-Sort-Shuffle"><a href="#2-Sort-Shuffle" class="headerlink" title="2.Sort Shuffle"></a>2.Sort Shuffle</h4><p>1 普通机制的SortShuffleManager</p>
<p><img src="/2022/01/19/spark-shuffle/12.JPG" alt></p>
<p><img src="/2022/01/19/spark-shuffle/8.JPG" alt></p>
<p>2 bypass</p>
<p><img src="/2022/01/19/spark-shuffle/9.JPG" alt></p>
<p> 此时task会为每个reduce端的task都创建一个临时磁盘文件，并将数据按key进行hash，然后根据key的hash值，将key写入对应的磁盘文件之中。当然，写入磁盘文件时也是先写入内存缓冲，缓冲写满之后再溢写到磁盘文件的。最后，同样会将所有临时磁盘文件都合并成一个磁盘文件，并创建一个单独的索引文件。<br> 该过程的磁盘写机制其实跟未经优化的HashShuffleManager是一模一样的，因为都要创建数量惊人的磁盘文件，只是在最后会做一个磁盘文件的合并而已。因此少量的最终磁盘文件，也让该机制相对未经优化的HashShuffleManager来说，shuffle read的性能会更好。</p>
<p>3 总结</p>
<p>bypass与普通SortShuffleManager运行机制的不同在于：<br>第一，磁盘写机制不同;<br>第二，不会进行排序。也就是说，启用该机制的最大好处在于，shuffle write过程中，不需要进行数据的排序操作，也就节省掉了这部分的性能开销。</p>
<h2 id="3-对比"><a href="#3-对比" class="headerlink" title="3 对比"></a>3 对比</h2><p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/27643595">https://www.zhihu.com/question/27643595</a></p>
<h2 id="4-优化"><a href="#4-优化" class="headerlink" title="4 优化"></a>4 优化</h2><p>因此在我们的开发过程中，能避免则尽可能避免使用会进行shuffle的算子，尽量使用非shuffle算子</p>
<p>1 shuffle算子：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/py_tamir/article/details/95457813">https://blog.csdn.net/py_tamir/article/details/95457813</a></p>
<p>reduceByKey、join、distinct、repartition</p>
<p>2 非shuffle算子</p>
<p>map，flatMap</p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6/">基础组件</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6/spark/">spark</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6/spark/%E4%BC%98%E5%8C%96/">优化</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/shuffle/">shuffle</a></div><hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-01-18  <a class="commentCountImg" href="/2022/01/18/bigdata-component/#comment-container"><span class="display-none-class">41b81dc86cc7f1f6cc69819f6260c4d5</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="41b81dc86cc7f1f6cc69819f6260c4d5">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>fast  <i class="fas fa-pencil-alt"> </i>0.0 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/01/18/bigdata-component/">大数据组件</a></h1><div class="content"><p><strong>大数据组件分类</strong></p>
<p><img src="/2022/01/18/bigdata-component/1.JPG" alt></p>
<p><strong>发行版本</strong></p>
<p>免费：Apache </p>
<p>收费：（CDH，HDP，二合一），阿里云，亚马逊云，华为云等</p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6/">基础组件</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6/%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6/">基础组件</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%BB%84%E4%BB%B6/">大数据组件</a></div><hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-01-18  <a class="commentCountImg" href="/2022/01/18/cluster-clinet/#comment-container"><span class="display-none-class">d63e31e6e096fbe43c82a2f6b02c3902</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="d63e31e6e096fbe43c82a2f6b02c3902">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>7 m  <i class="fas fa-pencil-alt"> </i>1.0 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/01/18/cluster-clinet/">spark部署方式</a></h1><div class="content"><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_37163925/article/details/106260434">https://blog.csdn.net/qq_37163925/article/details/106260434</a></p>
<p><a target="_blank" rel="noopener" href="https://spark.apache.org/docs/latest/cluster-overview.html">https://spark.apache.org/docs/latest/cluster-overview.html</a></p>
<p><a target="_blank" rel="noopener" href="https://book.itheima.net/course/1269935677353533441/1270998166728089602/1270999667882074115">https://book.itheima.net/course/1269935677353533441/1270998166728089602/1270999667882074115</a></p>
<p>通过设置mater来选择部署方式。该属性没有默认值。这是Spark程序需要连接的集群管理器所在的URL地址。如果这个属性在提交应用程序的时候没设置，程序将会通过System.getenv(“MASTER”)来获取MASTER环境变量；但是如果MASTER环境变量没有设定，那么程序将会把master的值设定为local[*]，之后程序将在本地启动。</p>
<p>local为单机</p>
<p>standalone是Spark自身实现资源调度</p>
<p>yarn为使用hadoop yarn来实现资源调度</p>
<h2 id="1-local"><a href="#1-local" class="headerlink" title="1 local"></a>1 local</h2><p>本地模式就是以一个独立的进程，通过其内部的多个线程来模拟整个Spark运行时环境</p>
<p>local【N】：N为线程数量，通常N为cpu的core的数量</p>
<p>local【*】：cpu的core数量</p>
<p>跑local可以不依赖hadoop</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/wangmuming/article/details/37695619">https://blog.csdn.net/wangmuming/article/details/37695619</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/bettesu/article/details/68512570">https://blog.csdn.net/bettesu/article/details/68512570</a></p>
<h2 id="2-Standalone"><a href="#2-Standalone" class="headerlink" title="2 Standalone"></a>2 Standalone</h2><p><a target="_blank" rel="noopener" href="https://sfzsjx.github.io/2019/08/26/spark-standalone-%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86">https://sfzsjx.github.io/2019/08/26/spark-standalone-%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86</a></p>
<h4 id="2-1-client"><a href="#2-1-client" class="headerlink" title="2.1 client"></a>2.1 client</h4><p><img src="/2022/01/18/cluster-clinet/1.png" alt></p>
<p>执行流程</p>
<ol>
<li>client 模式提交任务后，会在客户端启动Driver进程。</li>
<li>Driver 会向Master申请启动Application启动资源。</li>
<li>资源申请成功后，Driver端会将task发送到worker端执行。</li>
<li>worker端执行成功后将执行结果返回给Driver端</li>
</ol>
<h4 id="2-2-cluster"><a href="#2-2-cluster" class="headerlink" title="2.2 cluster"></a>2.2 cluster</h4><p><img src="/2022/01/18/cluster-clinet/2.png" alt></p>
<p>执行流程：</p>
<ol>
<li>客户端使用命令spark-submit –deploy-mode cluster 后会启动spark-submit进程</li>
<li>此进程为Driver向Master 申请资源。</li>
<li>Master会随机在一台Worker节点来启动Driver进程。</li>
<li>Driver启动成功后，spark-submit关闭，然后Driver向Master申请资源。</li>
<li>Master接收到请求后，会在资源充足的Worker节点上启动Executor进程。</li>
<li>Driver分发Task到Executor中执行。</li>
</ol>
<h4 id="2-3-高可用HA"><a href="#2-3-高可用HA" class="headerlink" title="2.3 高可用HA"></a>2.3 高可用HA</h4><p><img src="/2022/01/18/cluster-clinet/14.JPG" alt></p>
<p><img src="/2022/01/18/cluster-clinet/15.JPG" alt></p>
<h2 id="3-Mesos"><a href="#3-Mesos" class="headerlink" title="3 Mesos"></a>3 Mesos</h2><p>a general cluster manager that can also run Hadoop MapReduce and service applications. (Deprecated)</p>
<h2 id="4-YARN"><a href="#4-YARN" class="headerlink" title="4 YARN"></a>4 YARN</h2><p>为什么要YARN？</p>
<p><img src="/2022/01/18/cluster-clinet/16.JPG" alt></p>
<p><img src="/2022/01/18/cluster-clinet/6.JPG" alt></p>
<p>Spark On YARN是有两种运行模式的,一种是Cluster模式一种是Client模式.这两种模式的区别就是Driver运行的位置.</p>
<p>Cluster模式即:Driver运行在YARN容器内部, 和ApplicationMaster在同一个容器内</p>
<p>Client模式即:Driver运行在客户端进程中, 比如Driver运行在spark-submit程序的进程中</p>
<p><img src="/2022/01/18/cluster-clinet/9.JPG" alt></p>
<h3 id="4-1-cluster"><a href="#4-1-cluster" class="headerlink" title="4.1 cluster"></a>4.1 cluster</h3><p><img src="/2022/01/18/cluster-clinet/11.JPG" alt></p>
<p>具体流程步骤如下：<br>1）、任务提交后会和ResourceManager通讯申请启动ApplicationMaster;<br>2）、随后ResourceManager分配Container，在合适的NodeManager上启动ApplicationMaster，此时的ApplicationMaster就是Driver；<br>3）、Driver启动后向ResourceManager申请Executor内存，ResourceManager接到ApplicationMaster的资源申请后会分配Container,然后在合适的NodeManager上启动Executor进程;<br>4）、Executor进程启动后会向Driver反向注册;<br>5）、Executor全部注册完成后Driver开始执行main函数，之后执行到Action算子时，触发一个job，并根据宽依赖开始划分stage，每个stage生成对应的taskSet，之后将task分发到各个Executor上执行;</p>
<h3 id="4-2-client"><a href="#4-2-client" class="headerlink" title="4.2 client"></a>4.2 client</h3><p><img src="/2022/01/18/cluster-clinet/12.JPG" alt></p>
<p>具体流程步骤如下：<br>1）、Driver在任务提交的本地机器上运行，Driver启动后会和ResourceManager通讯申请启动ApplicationMaster；<br>2）、随后ResourceManager分配Container，在合适的NodeManager上启动ApplicationMaster，此时的ApplicationMaster的功能相当于一个ExecutorLaucher，只负责向ResourceManager申请Executor内存；<br>3）、ResourceManager接到ApplicationMaster的资源申请后会分配Container，然后ApplicationMaster在资源分配指定的NodeManager上启动Executor进程；<br>4）、Executor进程启动后会向Driver反向注册，Executor全部注册完成后Driver开始执行main函数；<br>5）、之后执行到Action算子时，触发一个Job，并根据宽依赖开始划分Stage，每个Stage生成对应的TaskSet，之后将Task分发到各个Executor上执行。</p>
<h2 id="5-Kubernetes"><a href="#5-Kubernetes" class="headerlink" title="5 Kubernetes"></a>5 Kubernetes</h2><p>an open-source system for automating deployment, scaling, and management of containerized applications.</p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6/">基础组件</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6/spark/">spark</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6/spark/%E4%BD%BF%E7%94%A8/">使用</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/spark%E9%83%A8%E7%BD%B2%E6%96%B9%E5%BC%8F/">spark部署方式</a></div><hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-01-13  <a class="commentCountImg" href="/2022/01/13/datawarehouse-multi-layer/#comment-container"><span class="display-none-class">b5242608afebe714a6d1369260463405</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="b5242608afebe714a6d1369260463405">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>8 m  <i class="fas fa-pencil-alt"> </i>1.1 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/01/13/datawarehouse-multi-layer/">数仓分层</a></h1><div class="content"><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/BeiisBei/article/details/105723188#_19">https://blog.csdn.net/BeiisBei/article/details/105723188#_19</a></p>
<p><a target="_blank" rel="noopener" href="https://www.saoniuhuo.com/article/detail-72.html">https://www.saoniuhuo.com/article/detail-72.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.dianjilingqu.com/20890.html">https://www.dianjilingqu.com/20890.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.i4k.xyz/article/wjt199866/115184169#ODS__100">https://www.i4k.xyz/article/wjt199866/115184169#ODS__100</a></p>
<h2 id="1-为什么要分层"><a href="#1-为什么要分层" class="headerlink" title="1.为什么要分层"></a>1.为什么要分层</h2><p>1.清晰数据结构：每一个数据分层都有它的作用域，这样我们在使用表的时候能更方便地定位和理解。<br>2.数据血缘追踪：简单来讲可以这样理解，我们最终给业务呈现的是一张能直接使用的张业务表，但是它的来源有很多，如果有一张来 源表出问题了，我们希望能够快速准确地定位到问题，并清楚它的危害范围。<br>3.减少重复开发：规范数据分层，开发一些通用的中间层数据，能够减少极大的重复计算。<br>4.把复杂问题简单化：将一个复杂的任务分解成多个步骤来完成，每一层只处理单一的步骤，比较简单和容易理解。而且便于维护数据的准确性，当数据出现问题之后，可以不用修复所有的数据，只需要从有问题的步骤开始修复。<br>5.屏蔽原始数据的异常：屏蔽业务的影响，不必改一次业务就需要重新接入数据。</p>
<h2 id="2-分层结构"><a href="#2-分层结构" class="headerlink" title="2.分层结构"></a>2.分层结构</h2><p><img src="/2022/01/13/datawarehouse-multi-layer/11.png" alt></p>
<h3 id="2-1-ODS层"><a href="#2-1-ODS层" class="headerlink" title="2.1 ODS层"></a>2.1 ODS层</h3><p><strong>作用</strong></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/xuebo_911/article/details/8156016#">https://blog.csdn.net/xuebo_911/article/details/8156016#</a></p>
<p>起到备份数据的作用</p>
<p><strong>构建</strong></p>
<p>1 直接加载原始日志、数据，保持原貌不做处理</p>
<h3 id="2-2-DIM层"><a href="#2-2-DIM层" class="headerlink" title="2.2 DIM层"></a>2.2 DIM层</h3><p>dim存放维度表，dwd存放事实表</p>
<p><strong>作用</strong></p>
<p>维度表可以看作是用户来分析数据的窗口，维度表中包含事实数据表中事实记录的特性，有些特性提供描述性信息，有些特性指定如何汇总事实数据表数据，以便为分析者提供有用的信息，维度表包含帮助汇总数据的特性的层次结构。</p>
<p><strong>构建</strong></p>
<p><a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/137615.html">https://help.aliyun.com/document_detail/137615.html</a></p>
<p>1 构建维度表，主要是对业务事实的描述信息，例如何人，何时，何地等</p>
<h3 id="2-3-DWD层"><a href="#2-3-DWD层" class="headerlink" title="2.3 DWD层"></a>2.3 DWD层</h3><p><strong>作用</strong></p>
<p>保存业务事实明细，一行信息代表一次业务行为，例如一次下单。</p>
<p><strong>构建</strong></p>
<p>1 对ODS层数据进行清洗（去除空值，脏数据，超过极限范围的数据、脱敏等）</p>
<p>2 构建事实表</p>
<p><a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/114457.html">https://help.aliyun.com/document_detail/114457.html</a></p>
<h3 id="2-4-DWS"><a href="#2-4-DWS" class="headerlink" title="2.4 DWS"></a>2.4 DWS</h3><p><strong>作用</strong></p>
<p>避免重复计算</p>
<p>1）问题引出</p>
<p>两个需求，统计每个省份订单的个数、统计每个省份订单的总金额，都是将省份表和订单表进行join，group by省份，然后计算。同样数据被计算了两次，实际上类似的场景还会更多。</p>
<p>2） 那怎么设计能避免重复计算呢？</p>
<p>针对上述场景，可以设计一张地区宽表，其主键为地区ID，字段包含为：下单次数、下单金额、支付次数、支付金额等。上述所有指标都统一进行计算，并将结果保存在该宽表中，这样就能有效避免数据的重复计算。</p>
<p><strong>构建</strong></p>
<p><a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/126913.html">https://help.aliyun.com/document_detail/126913.html</a></p>
<p>0 分主题</p>
<p>1 构建宽表</p>
<p>2 以DWD为基础，按天进行轻度汇总。DWS层存放的所有主题对象当天的汇总行为，例如每个地区当天的下单次数，下单金额等</p>
<h3 id="2-5-DWT"><a href="#2-5-DWT" class="headerlink" title="2.5 DWT"></a>2.5 DWT</h3><p><strong>和DWS区别</strong></p>
<p>DWS按天进行轻度汇总，DWT累积汇总</p>
<p><strong>作用</strong></p>
<p>避免重复计算</p>
<p><strong>构建</strong></p>
<p>0 分主题</p>
<p>1 构建宽表</p>
<p>2 以DWS为基础，对数据进行累积汇总。DWT层存放的是所有主题对象的累积行为，例如每个地区最近７天（１５天、３０天、６０天）的下单次数、下单金额等</p>
<h3 id="2-6-ADS层"><a href="#2-6-ADS层" class="headerlink" title="2.6 ADS层"></a>2.6 ADS层</h3><p><strong>作用</strong></p>
<p>为各种统计报表提供数据</p>
<p><strong>构建</strong></p>
<p>1 由于这层的数据量不大，所有没有分区，列式存储，压缩 </p>
<h2 id="3-构建过程"><a href="#3-构建过程" class="headerlink" title="3.构建过程"></a>3.构建过程</h2><p>借助hive，主要就是写SQL，核心步骤就是：</p>
<p>1.建表</p>
<p>2.分区规划</p>
<p>​    按什么分区，比如说按天，按月</p>
<p>​    注意数据同步策略，全量，增量等</p>
<p>3.数据装载</p>
<p>​    注意首日，每日</p>
<p>联系业务和不同层的要求</p>
<h2 id="4-全流程调度"><a href="#4-全流程调度" class="headerlink" title="4.全流程调度"></a>4.全流程调度</h2><p>Azkaban</p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/">数据仓库</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E6%95%B0%E4%BB%93/">数仓</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E6%95%B0%E4%BB%93/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93/">离线数仓</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/%E6%9E%84%E5%BB%BA%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/">构建数据仓库</a></div><hr></div></article></div><!--!--><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/page/12/">Previous</a></div><div class="pagination-next"><a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/page/14/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/page/12/">12</a></li><li><a class="pagination-link is-current" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/page/13/">13</a></li><li><a class="pagination-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/page/14/">14</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://avatars.githubusercontent.com/u/50144751?v=4" alt="Lavine Hu"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Lavine Hu</p><p class="is-size-6 is-block">我能卖你生瓜蛋子？</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>杭州</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">396</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">141</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">378</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/hlw95" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/hlw95"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Weibo" href="/null"><i class="fab fa-weibo"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="/18829272646@163.com"><i class="fa fa-envelope"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Next" href="/null"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div><div><hr><p id="hitokoto">:D 一言句子获取中...</p><script type="text/javascript" defer>function getYiyan(){
                                $.getJSON("https://v1.hitokoto.cn/", function (data) {
                                if(data){
                                    $('#hitokoto').html("");
                                    $('#hitokoto').append("<strong style='color: #3273dc;'>"+data.hitokoto+"</strong>"+
                                    "<p>"+"From《"+data.from+"》</p><p>Provider-"+data.creator+"</p>");
                                }});}
                                $(function (){getYiyan();$('#hitokoto').click(function(){getYiyan();})});</script></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-03-17T11:54:11.000Z">2024-03-17</time></p><p class="title"><a href="/2024/03/17/es/">es</a></p><p class="categories"><a href="/categories/es/">es</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-03-17T11:33:28.000Z">2024-03-17</time></p><p class="title"><a href="/2024/03/17/design-pattern/">设计模式</a></p><p class="categories"><a href="/categories/c/">c++</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-03-17T11:28:40.000Z">2024-03-17</time></p><p class="title"><a href="/2024/03/17/cpp-high-performance/">高性能变编程</a></p><p class="categories"><a href="/categories/c/">c++</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-05-03T13:50:10.000Z">2023-05-03</time></p><p class="title"><a href="/2023/05/03/cpp-lang/">c++语法</a></p><p class="categories"><a href="/categories/c/">c++</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-16T13:01:22.000Z">2023-04-16</time></p><p class="title"><a href="/2023/04/16/cpp_init/">编译</a></p><p class="categories"><a href="/categories/c/">c++</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/GNN/"><span class="level-start"><span class="level-item">GNN</span></span><span class="level-end"><span class="level-item tag">11</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/GNN/GCN/"><span class="level-start"><span class="level-item">GCN</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/GNN/GNN/"><span class="level-start"><span class="level-item">GNN</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/GNN/%E5%B0%8F%E5%B8%AE%E6%89%8B/"><span class="level-start"><span class="level-item">小帮手</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/NLP/"><span class="level-start"><span class="level-item">NLP</span></span><span class="level-end"><span class="level-item tag">68</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/NLP/NLP/"><span class="level-start"><span class="level-item">NLP</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/NLP/PTM/"><span class="level-start"><span class="level-item">PTM</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/NLP/Prompt/"><span class="level-start"><span class="level-item">Prompt</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/NLP/Tokenization/"><span class="level-start"><span class="level-item">Tokenization</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/NLP/%E4%BF%A1%E6%81%AF%E6%8A%BD%E5%8F%96/"><span class="level-start"><span class="level-item">信息抽取</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><a class="level is-mobile is-marginless" href="/categories/"><span class="level-start"><span class="level-item">查看全部&gt;&gt;</span></span></a></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2024/03/"><span class="level-start"><span class="level-item">March 2024</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2023/05/"><span class="level-start"><span class="level-item">May 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2023/04/"><span class="level-start"><span class="level-item">April 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2022/10/"><span class="level-start"><span class="level-item">October 2022</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2022/09/"><span class="level-start"><span class="level-item">September 2022</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><a class="level is-mobile is-marginless" href="/archives/"><span class="level-start"><span class="level-item">查看全部&gt;&gt;</span></span></a></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/PTM/"><span class="tag">PTM</span><span class="tag is-grey-lightest">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%96%87%E6%9C%AC%E8%A1%A8%E7%A4%BA/"><span class="tag">文本表示</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D/"><span class="tag">文本匹配</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8F%AC%E5%9B%9E/"><span class="tag">召回</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB/"><span class="tag">文本分类</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%96%87%E6%9C%AC%E6%94%B9%E5%86%99/"><span class="tag">文本改写</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><span class="tag">设计模式</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Atlas/"><span class="tag">Atlas</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AutoTokenizer/"><span class="tag">AutoTokenizer</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Azkaban/"><span class="tag">Azkaban</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BertGCN/"><span class="tag">BertGCN</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Bert%E6%96%87%E6%9C%AC%E8%A1%A8%E7%A4%BA/"><span class="tag">Bert文本表示</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CDC%EF%BC%88Change-Data-Capture%EF%BC%89%E5%B7%A5%E5%85%B7%E5%AF%B9%E6%AF%94/"><span class="tag">CDC（Change Data Capture）工具对比</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CRF%E5%92%8CHMM/"><span class="tag">CRF和HMM</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ChineseBERT-Chinese-Pretraining-Enhanced-by-Glyph-and-Pinyin-Information/"><span class="tag">ChineseBERT Chinese Pretraining Enhanced by Glyph and Pinyin Information</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DAG/"><span class="tag">DAG</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DGL/"><span class="tag">DGL</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DGL-notice/"><span class="tag">DGL notice</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DIEN/"><span class="tag">DIEN</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DIN/"><span class="tag">DIN</span><span class="tag is-grey-lightest">1</span></a></div></div><div class="field is-grouped is-grouped-multiline"><a class="tags has-addons" href="/tags/"><span class="tag">查看全部&gt;&gt;</span></a></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><!--!--></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Lavine Hu</a><p class="size-small"><span>&copy; 2024 Lavine Hu</span>  Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a> &amp; <a href="https://github.com/removeif/hexo-theme-amazing" target="_blank">Amazing</a> <br><span>© 版权说明：[本网站所有内容均收集于互联网或自己创作,<br />&nbsp;&nbsp;&nbsp;&nbsp;方便于网友与自己学习交流，如有侵权，请<a href="/message" target="_blank">留言</a>，立即处理]<br /></span><span><span id="statistic-times">loading...</span><script>function createTime(time) {
            var n = new Date(time);
            now.setTime(now.getTime() + 250),
                days = (now - n) / 1e3 / 60 / 60 / 24,
                dnum = Math.floor(days),
                hours = (now - n) / 1e3 / 60 / 60 - 24 * dnum,
                hnum = Math.floor(hours),
            1 == String(hnum).length && (hnum = "0" + hnum),
                minutes = (now - n) / 1e3 / 60 - 1440 * dnum - 60 * hnum,
                mnum = Math.floor(minutes),
            1 == String(mnum).length && (mnum = "0" + mnum),
                seconds = (now - n) / 1e3 - 86400 * dnum - 3600 * hnum - 60 * mnum,
                snum = Math.round(seconds),
            1 == String(snum).length && (snum = "0" + snum),
                document.getElementById("statistic-times").innerHTML = "❤️Site from <strong>"+time.split(" ")[0].replace(/\//g,".")+"</strong> has existed <strong>" + dnum + "</strong> d <strong>" + hnum + "</strong> h <strong>" + mnum + "</strong> m <strong>" + snum + "</strong> s！❤️";
        }var now = new Date();setInterval("createTime('2021/07/17 00:00:00')", 250,"");</script><br></span><div class="size-small"><span>❤️Thx <strong><span id="busuanzi_value_site_uv">99+</span></strong> users <strong><span id="busuanzi_value_site_pv">99+</span></strong> visited！❤️</span></div></p></div><div class="level-end"><div class="sideMusic"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="/js/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><meting-js style="width: auto;height: 2000px;" server="netease" type="playlist" id="2364053447" theme="#2980b9" loop="all" autoplay="false" order="list" storageName="aplayer-setting" lrctype="0" list-max-height="400px" fixed="true"></meting-js></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" async></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><script src="/js/main.js" defer></script><script>$.getScript('/js/comment-issue-data.js',function(){loadIssueData('a0eb7de1c4dc4908943b','b466946cbbe843a4a6ef249eb54ae5956d2f91c3','hlw95','hlw95.github.io',false);})</script><!--!--><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script><script type="text/javascript">var pjax = new Pjax({
            elements: "a",//代表点击链接就更新
            selectors: [  //代表要更新的节点
                ".section",
                "title"
            ],
            cache: true,
            cacheBust:false
        })

        function loadBusuanzi(){
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js", function () {});
        }

        function loadMathJax() { //加载mathjax
            $.getScript("//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML", function () {
                MathJax.Hub.Config({ tex2jax: { inlineMath: [['$', '$'], ['\(', '\)']] } });
                var math = document.getElementsByClassName("entry-content")[0];
                MathJax.Hub.Queue(["Typeset", MathJax.Hub, math]);
            });
        };

        // 开始 PJAX 执行的函数
        document.addEventListener('pjax:send', function () {
        });
        
        // PJAX 完成之后执行的函数，可以和上面的重载放在一起
        document.addEventListener('pjax:complete', function () {
            $(".section").css({opacity:1});
            if(true){
                $.getScript('/js/comment-issue-data.js',function(){loadIssueData('a0eb7de1c4dc4908943b','b466946cbbe843a4a6ef249eb54ae5956d2f91c3','hlw95','hlw95.github.io',false);});
            }
            if(false){
                loadMathJax();
            }
            loadMainJs(jQuery, window.moment, window.ClipboardJS, window.IcarusThemeSettings);
            loadBackTop();
            loadBusuanzi();
            if(typeof loadBanner == 'function'){
                loadBanner();
            }
        });</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"display":null,"superSample":2,"width":250,"height":500,"position":"right","hOffset":0,"vOffset":-20,"jsonPath":"/live2dw/assets/hijiki.model.json"},"mobile":{"show":true,"scale":0.5,"react":null,"opacityDefault":0.7,"opacityOnHover":0.2},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>